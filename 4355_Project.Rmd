---
title: "4355 Project"
author: "Alondra Ramos"
output:
  word_document: default
  html_document:
    df_print: paged
---

```{r}
df <- read.csv("Top500.csv")
```

# data cleaning
```{r}
summary(df)

library(dplyr)

# removing non-numeric attribtutes
df.1 <- tbl_df(df)
df.1 <- select(df.1, -c('Ã¯..title', 'artist', 'top.genre', 'added', 'dur'))
```
```{r}
glimpse(df.1)
```
# data exploration
```{r}
library(ggplot2)

ggplot(df.1, aes(nrgy)) +
  geom_histogram(col = "black", fill = "#009E73") +
  labs(title="Song Energy", y="count", x="nrgy level")

```
```{r}
library(reshape2)

df.2 <- melt(df.1[,1:10], id.vars = 'pop')

ggplot(df.2) +
geom_jitter(aes(value,pop, colour=variable),) +
geom_smooth(aes(value,pop, colour=variable), method=lm, se=FALSE) +
facet_wrap(~variable, scales="free_x")

df.2 <- melt(df.1[,1:10], id.vars = 'live')

ggplot(df.2) +
geom_jitter(aes(value,live, colour=variable),) +
geom_smooth(aes(value,live, colour=variable), method=lm, se=FALSE) +
facet_wrap(~variable, scales="free_x")

df.2 <- melt(df.1[,1:10], id.vars = 'nrgy')

ggplot(df.2) +
geom_jitter(aes(value,nrgy, colour=variable),) +
geom_smooth(aes(value,nrgy, colour=variable), method=lm, se=FALSE) +
facet_wrap(~variable, scales="free_x")

df.2 <- melt(df.1[,1:10], id.vars = 'acous')

ggplot(df.2) +
geom_jitter(aes(value,acous, colour=variable),) +
geom_smooth(aes(value,acous, colour=variable), method=lm, se=FALSE) +
facet_wrap(~variable, scales="free_x")

df.2 <- melt(df.1[,1:10], id.vars = 'spch')

ggplot(df.2) +
geom_jitter(aes(value,spch, colour=variable),) +
geom_smooth(aes(value,spch, colour=variable), method=lm, se=FALSE) +
facet_wrap(~variable, scales="free_x")

df.2 <- melt(df.1[,1:10], id.vars = 'dB')

ggplot(df.2) +
geom_jitter(aes(value,dB, colour=variable),) +
geom_smooth(aes(value,dB, colour=variable), method=lm, se=FALSE) +
facet_wrap(~variable, scales="free_x")

df.2 <- melt(df.1[,1:10], id.vars = 'bpm')

ggplot(df.2) +
geom_jitter(aes(value,bpm, colour=variable),) +
geom_smooth(aes(value,bpm, colour=variable), method=lm, se=FALSE) +
facet_wrap(~variable, scales="free_x")

df.2 <- melt(df.1[,1:10], id.vars = 'year')

ggplot(df.2) +
geom_jitter(aes(value, year, colour=variable),) +
geom_smooth(aes(value, year, colour=variable), method=lm, se=FALSE) +
facet_wrap(~variable, scales="free_x")

df.2 <- melt(df.1[,1:10], id.vars = 'dnce')

ggplot(df.2) +
geom_jitter(aes(value, dnce, colour=variable),) +
geom_smooth(aes(value, dnce, colour=variable), method=lm, se=FALSE) +
facet_wrap(~variable, scales="free_x")

df.2 <- melt(df.1[,1:10], id.vars = 'val')

ggplot(df.2) +
geom_jitter(aes(value, val, colour=variable),) +
geom_smooth(aes(value, val, colour=variable), method=lm, se=FALSE) +
facet_wrap(~variable, scales="free_x")
```



# initial fitting
```{r}
fit.1 <- lm(nrgy~., data = df.1)
summary(fit.1)

```

# feature selection
```{r}
library(car)
vif(fit.1)
```

```{r}
cor(df.1[,c(1:2, 4:10)])
```
```{r}
par(mfrow = c(2, 2))
plot(fit.1)
```
# residual analysis
```{r}
library(MASS)

barplot(height = stdres(fit.1), names.arg = 1:6888,
        main = "Standardized Residuals", xlab = "Index",
        ylab = "Standardized Resid", ylim = c(-4, 4))

# cutoff values
abline(h = 3, col = "Red", lwd = 3)
abline(h = -3, col = "Red", lwd = 3)
```
# studentized residuals
```{r}
barplot(height = studres(fit.1), names.arg = 1:6888,
        main = "Studentized Residuals", xlab = "Index",
        ylab = "Studentized Resid", ylim = c(-4,4))

abline(h = 3, col = "Red", lwd = 3)
abline(h = -3, col = "Red", lwd = 3)
```
# r student residuals
```{r}
barplot(height = rstudent(fit.1), names.arg = 1:6888,
        main = "R Student Residuals", xlab = "Index",
        ylab = "R Student Resid", ylim = c(-5, 5))

cor.level <- 0.05/(2 * 6888)
cor.qt <- qt(cor.level, 6878, lower.tail=F)

abline(h = cor.qt, col = "Red", lwd = 3)
abline(h = -cor.qt, col = "Red", lwd = 3)
```
## Influential Analysis
```{r}
myInf <- influence.measures(fit.1)
summary(myInf)
```
```{r}
library(car)
dfbetasPlots(fit.1, intercept = F)
```
```{r}
influenceIndexPlot(fit.1)
```
## Fittings with suspected outliers removed

```{r}
# removing suspected outliers
df.red.1 <- df.1[-c(6671, 6685, 6686),]

fit.2 <- lm(nrgy~., data = df.red.1)
summary(fit.2)
```
```{r}
par(mfrow = c(2, 2))
plot(fit.2)
```
##  Testing for heteroscedascity
```{r}
library(lmtest)
bptest(fit.2)

```


## Testing Transformations

Although there are some improvements in the R^2 values with the transformations, there seems to be a loss in the results for the residuals that indicate a slightly poorer fit.

# log(nrgy)

```{r}
fit.3 <- lm(log(nrgy)~., data = df.red.1)
summary(fit.3)
```
```{r}
par(mfrow = c(2, 2))
plot(fit.3)
```
# sqrt(nrgy)
```{r}
fit.4 <- lm(sqrt(nrgy)~., data = df.red.1)
summary(fit.4)
```
```{r}
par(mfrow = c(2, 2))
plot(fit.3)
```
```{r}
wt <- 1 / lm(abs(fit.2$residuals) ~ fit.2$fitted.values)$fitted.values^2
fit.wls <- lm(nrgy~., data = df.red.1, weights = wt)
summary(fit.wls)
```


